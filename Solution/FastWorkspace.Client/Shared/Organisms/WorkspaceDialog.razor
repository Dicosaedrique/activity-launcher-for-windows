@inject WorkspaceController WorkspaceController
@inject IStringLocalizer<AppLocales> Localize

<MudDialog>
    <DialogContent>
        <MudForm @ref="_form" @bind-IsValid="_success">
            <MudTextField T="string" @bind-Value="@_workspace.Name" Label="@Localize["Workspace.Dialog.Name.Label"]" Required="true" RequiredError="@Localize["Workspace.Dialog.Name.RequiredError"]" />
            <MudTextField T="string" @bind-Value="@_workspace.Description" Label="@Localize["Workspace.Dialog.Description.Label"]" Lines="5" />
        </MudForm>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="MudDialog.Cancel">@Localize["Workspace.Dialog.CancelButton"]</MudButton>
        <MudButton Color="Color.Primary" Disabled="@(!_success)" OnClick="Submit">@SubmitButtonLabel</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter]
    public MudDialogInstance MudDialog { get; set; } = null!;

    [Parameter]
    public Workspace? WorkspaceToEdit { get; set; }

    private bool IsEdit => WorkspaceToEdit != null;

    private string SubmitButtonLabel => IsEdit ? Localize["Workspace.Dialog.Edit.SubmitButton"] : Localize["Workspace.Dialog.Create.SubmitButton"];

    private MudForm _form = null!;
    private bool _success;

    private Workspace _workspace = new();

    protected override void OnInitialized()
    {
        if (IsEdit)
        {
            _workspace = WorkspaceToEdit!.Clone();
        }
    }

    private async Task Submit()
    {
        if (string.IsNullOrWhiteSpace(_workspace.Name)) return;

        _workspace.Description = string.IsNullOrWhiteSpace(_workspace.Description) ? null : _workspace.Description;

        if (IsEdit) await Edit();
        else await Create();
    }

    private async Task Create()
    {
        var success = await WorkspaceController.CreateWorkspace(_workspace);

        if (success)
        {
            MudDialog.Close(DialogResult.Ok(true));
        }
    }

    private async Task Edit()
    {
        var success = await WorkspaceController.UpdateWorkspace(_workspace);

        if (success)
        {
            MudDialog.Close(DialogResult.Ok(true));
        }
    }
}
